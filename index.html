<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birbank - HR Audit Checklist (Final Design)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Birbank Brand Colors */
            --primary: #E30613;
            --primary-hover: #C40511;
            --bg-body: #F4F5F7;
            --card-bg: #FFFFFF;
            --text-main: #172B4D;
            --text-muted: #5E6C84;
            --border-color: #DFE1E6;
            
            /* Status Colors */
            --success-bg: #E3FCEF; --success-text: #006644;
            --warning-bg: #FFF0B3; --warning-text: #B38600;
            --danger-bg: #FFEBE6; --danger-text: #BF2600;
            --info-bg: #DEEBFF; --info-text: #0747A6;
            --purple-bg: #EAE6FF; --purple-text: #403294;

            /* Spacing & Radius */
            --radius: 16px;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --container-width: 1400px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; font-family: 'Inter', sans-serif; }
        
        body { 
            background-color: var(--bg-body); 
            color: var(--text-main); 
            min-height: 100vh; 
            padding-bottom: 100px;
            line-height: 1.5;
        }

        /* --- HEADER --- */
        .header {
            background: var(--card-bg);
            padding: 18px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-bottom: 1px solid var(--border-color);
        }

        .container {
            max-width: var(--container-width);
            margin: 0 auto;
            padding: 0 40px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-main);
            letter-spacing: -0.5px;
        }

        .brand i { color: var(--primary); }

        .sync-status {
            background: var(--success-bg);
            color: var(--success-text);
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .sync-indicator {
            width: 10px;
            height: 10px;
            background: currentColor;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .sync-loading { background: var(--warning-bg); color: var(--warning-text); }

        /* --- STATS DASHBOARD --- */
        .stats-dashboard {
            margin-top: 40px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 30px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 24px;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease;
        }

        .stat-card:hover { transform: translateY(-5px); }

        .stat-icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            background: rgba(227, 6, 19, 0.08);
            color: var(--primary);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            flex-shrink: 0;
        }

        .stat-text { flex: 1; }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--text-main);
            line-height: 1.1;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .progress-wrapper {
            margin-top: 12px;
            width: 100%;
            height: 8px;
            background: #EBECF0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- CONTROL PANEL --- */
        .control-panel {
            background: var(--card-bg);
            padding: 24px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            margin: 40px 0;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: var(--shadow);
        }

        .search-wrapper {
            flex: 1;
            position: relative;
            min-width: 320px;
        }

        .search-input {
            width: 100%;
            padding: 16px 20px 16px 55px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1rem;
            background: #FAFBFC;
            transition: 0.2s;
            color: var(--text-main);
            font-weight: 500;
        }

        .search-input:focus {
            border-color: var(--primary);
            background: #fff;
            box-shadow: 0 0 0 4px rgba(227, 6, 19, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 1.2rem;
        }

        .filter-buttons { display: flex; gap: 12px; }

        .filter-btn {
            padding: 14px 24px;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-muted);
            display: flex;
            gap: 10px;
            align-items: center;
            transition: 0.2s;
            font-size: 0.95rem;
        }

        .filter-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: #FFF5F5;
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* --- CATEGORIES --- */
        .category {
            background: var(--card-bg);
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            overflow: hidden;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .category-header {
            padding: 25px 35px;
            background: linear-gradient(to right, #fff, #FAFBFC);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .category-header:hover { background: #F4F5F7; }

        .cat-left { display: flex; align-items: center; gap: 20px; flex: 1; }

        .category-icon-wrapper {
            width: 52px;
            height: 52px;
            background: var(--text-main);
            color: #fff;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .category-title {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--text-main);
            margin-bottom: 4px;
        }

        .category-badge {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 600;
        }

        .cat-right { display: flex; align-items: center; gap: 30px; }

        .cat-progress-container {
            display: flex;
            align-items: center;
            gap: 15px;
            width: 220px;
        }

        .cat-progress-bar {
            flex: 1;
            height: 10px;
            background: #EBECF0;
            border-radius: 5px;
            overflow: hidden;
        }

        .cat-progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.5s ease;
        }

        .cat-progress-text {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-main);
            min-width: 45px;
            text-align: right;
        }

        .category-toggle {
            font-size: 1.2rem;
            color: var(--text-muted);
            transition: transform 0.3s ease;
        }

        .category-toggle.active { transform: rotate(180deg); }

        .category-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            background: #fff;
        }
        
        .category-content.active { max-height: 30000px; }

        /* --- SUBCATEGORIES --- */
        .subcategory-header {
            padding: 20px 35px;
            background: #FAFBFC;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            font-weight: 700;
            color: var(--text-main);
            font-size: 1rem;
        }

        .subcategory-header:hover { background: #EBECF0; }

        .subcategory-count {
            background: var(--text-muted);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .subcategory-content { display: none; }
        .subcategory-content.active { display: block; }

        /* --- ITEMS --- */
        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 24px;
            padding: 25px 35px;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s ease;
            background: white;
        }

        .checklist-item:last-child { border-bottom: none; }
        .checklist-item:hover { background-color: #FAFBFC; }
        
        .checklist-item.checked { background-color: #F8F9FA; }
        .checklist-item.checked .item-main-text { 
            text-decoration: line-through; 
            color: var(--text-muted); 
        }
        
        .checklist-item.has-notes { 
            background: #FFFDF5; 
            border-left: 5px solid var(--warning-text);
            padding-left: 30px; /* Adjust for border */
        }

        .checkbox-wrapper { padding-top: 4px; }

        .checkbox {
            appearance: none;
            width: 26px;
            height: 26px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            position: relative;
            background: #fff;
            transition: 0.2s;
        }

        .checkbox:hover { border-color: var(--primary); }
        .checkbox:checked { background: var(--primary); border-color: var(--primary); }
        .checkbox:checked::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
        }

        .item-content { flex: 1; }

        .item-text {
            font-size: 1.1rem;
            color: var(--text-main);
            font-weight: 500;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .item-id {
            font-size: 0.8rem;
            color: #B3BAC5;
            margin-right: 10px;
            font-weight: 700;
            display: inline-block;
        }

        /* Meta Badges */
        .item-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 12px;
        }

        .meta-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            gap: 8px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .meta-badge.status { background: var(--info-bg); color: var(--info-text); }
        .meta-badge.priority { background: var(--danger-bg); color: var(--danger-text); }
        .meta-badge.responsible { background: var(--purple-bg); color: var(--purple-text); text-transform: none; }
        .meta-badge.date { background: #EBECF0; color: var(--text-main); }

        /* Note Display */
        .item-note-display {
            margin-top: 16px;
            padding: 16px 20px;
            background: #FFF;
            border: 1px dashed var(--warning-text);
            border-radius: 10px;
            font-size: 0.95rem;
            color: var(--text-main);
            display: none;
            position: relative;
        }
        
        .item-note-display.visible { display: block; }
        
        .item-note-label {
            font-weight: 700;
            font-size: 0.8rem;
            color: var(--text-muted);
            display: block;
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .btn-note {
            background: white;
            color: var(--text-muted);
            border: 1px solid var(--border-color);
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 0.95rem;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: 0.2s;
            white-space: nowrap;
            box-shadow: var(--shadow-sm);
        }

        .btn-note:hover {
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-2px);
        }

        .has-notes .btn-note {
            background: var(--warning-bg);
            color: var(--warning-text);
            border-color: var(--warning-bg);
        }

        /* --- MODAL --- */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(23, 43, 77, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal.active { display: flex; animation: fadeIn 0.3s; }

        .modal-content {
            background: white;
            width: 100%;
            max-width: 650px;
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
        }

        .modal-icon {
            width: 56px;
            height: 56px;
            background: var(--primary);
            color: white;
            border-radius: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.6rem;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text-main);
        }

        .form-group { margin-bottom: 24px; }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--text-main);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1rem;
            background: #FAFBFC;
            transition: 0.2s;
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--primary);
            background: white;
            outline: none;
            box-shadow: 0 0 0 4px rgba(227, 6, 19, 0.1);
        }

        .form-textarea { min-height: 140px; resize: vertical; }

        .modal-buttons {
            display: flex;
            gap: 20px;
            margin-top: 40px;
        }

        .btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            transition: 0.2s;
            font-size: 1.1rem;
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-2px); }
        .btn-secondary { background: #EBECF0; color: var(--text-main); }
        .btn-secondary:hover { background: #DFE1E6; }

        /* --- NOTIFICATION --- */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: white;
            padding: 20px 30px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 16px;
            z-index: 3000;
            transform: translateX(150%);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-left: 6px solid var(--success-text);
        }

        .notification.active { transform: translateX(0); }
        .notification-icon { color: var(--success-text); font-size: 1.6rem; }
        .notification-text { font-weight: 700; color: var(--text-main); font-size: 1.1rem; }

        /* --- EXPORT --- */
        .export-section {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 60px 0;
        }

        .btn-export {
            padding: 16px 32px;
            background: var(--text-main);
            color: white;
            border-radius: 12px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1rem;
            transition: 0.2s;
        }

        .btn-export:hover {
            background: #091E42;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Responsive */
        @media (max-width: 1024px) {
            .stats-dashboard { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .container { padding: 0 20px; }
            .stats-dashboard { grid-template-columns: 1fr; }
            .header-content { flex-direction: column; align-items: flex-start; gap: 15px; }
            .checklist-item { padding: 20px; flex-direction: column; align-items: flex-start; }
            .cat-progress-container { display: none; }
            .btn-note { margin-left: 0; margin-top: 15px; width: 100%; justify-content: center; }
            .modal-content { padding: 25px; }
            .filter-buttons { overflow-x: auto; width: 100%; padding-bottom: 5px; }
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="container header-content">
            <div class="brand"><i class="fas fa-briefcase"></i> Birbank | HR Diagnostics</div>
            <div class="sync-status" id="syncStatus">
                <div class="sync-indicator"></div>
                <span id="syncText">Google Sheets Aktiv</span>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="stats-dashboard">
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-list"></i></div>
                <div class="stat-text"><div class="stat-value" id="totalItems">0</div><div class="stat-label">C…ômi Madd…ô</div></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: var(--success-bg); color: var(--success-text);"><i class="fas fa-check"></i></div>
                <div class="stat-text"><div class="stat-value" id="checkedItems">0</div><div class="stat-label">Tamamlandƒ±</div></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: var(--warning-bg); color: var(--warning-text);"><i class="fas fa-comment-dots"></i></div>
                <div class="stat-text"><div class="stat-value" id="withNotes">0</div><div class="stat-label">Qeydli Madd…ôl…ôr</div></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: var(--info-bg); color: var(--info-text);"><i class="fas fa-chart-pie"></i></div>
                <div class="stat-text">
                    <div class="stat-value" id="progressPercent">0%</div>
                    <div class="stat-label">√úmumi Progress</div>
                    <div class="progress-wrapper"><div class="progress-fill" id="progressBar" style="width: 0%"></div></div>
                </div>
            </div>
        </div>

        <div class="control-panel">
            <div class="search-wrapper">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="searchInput" class="search-input" placeholder="Madd…ôl…ôr arasƒ±nda axtarƒ±≈ü...">
            </div>
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterItems('all')"><i class="fas fa-layer-group"></i> Hamƒ±sƒ±</button>
                <button class="filter-btn" onclick="filterItems('checked')"><i class="fas fa-check-circle"></i> Tamam</button>
                <button class="filter-btn" onclick="filterItems('notes')"><i class="fas fa-sticky-note"></i> Qeydli</button>
            </div>
        </div>

        <div id="categoriesContainer"></div>

        <div class="export-section">
            <button class="btn-export" onclick="exportToExcel()"><i class="fas fa-file-excel"></i> Excel ƒ∞xrac</button>
            <button class="btn-export" onclick="window.print()"><i class="fas fa-print"></i> √áap Et</button>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="noteModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon"><i class="fas fa-pen"></i></div>
                <h2 class="modal-title">Audit Qeydi v…ô Status</h2>
            </div>
            <form id="noteForm">
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-select" id="itemStatus">
                        <option value="pending">‚è≥ G√∂zl…ôyir</option>
                        <option value="in-progress">üîÑ ƒ∞crada</option>
                        <option value="completed">‚úÖ Tamamlandƒ±</option>
                        <option value="issue">‚ö†Ô∏è Problem/Risk</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">M√º≈üahid…ô v…ô Qeydl…ôr</label>
                    <textarea class="form-textarea" id="itemNotes" placeholder="Audit zamanƒ± a≈ükar edil…ôn faktlar..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">M…ôsul ≈û…ôxs</label>
                    <input type="text" class="form-input" id="responsiblePerson" placeholder="Ad Soyad">
                </div>
                <div class="form-group">
                    <label class="form-label">Prioritet</label>
                    <select class="form-select" id="itemPriority">
                        <option value="low">üü¢ A≈üaƒüƒ±</option>
                        <option value="medium">üü° Orta</option>
                        <option value="high">üü† Y√ºks…ôk</option>
                        <option value="critical">üî¥ Kritik</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Son Tarix</label>
                    <input type="date" class="form-input" id="itemDueDate">
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="btn btn-primary">Yadda Saxla</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">L…ôƒüv Et</button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <div class="notification-icon"><i class="fas fa-check-circle"></i></div>
        <div class="notification-text" id="notificationText"></div>
    </div>

    <script>
        // Sƒ∞Zƒ∞N Lƒ∞NKƒ∞Nƒ∞Z:
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyuTVkENzEskOgy7DAUor2G57Kq_c7lQ8Jte-HJB4LTUl-hGK8KRUw2eYbTGaDbuNeyAQ/exec';

        const auditData = {
            "1. HR Governance & Policies": { icon: "fa-scale-balanced", subcategories: { "1.1 Siyas…ôt v…ô Prosedurlar": ["HR siyas…ôt v…ô prosedurlarƒ±nƒ±n m√∂vcudluƒüu v…ô aktualla≈üdƒ±rƒ±lmasƒ±","Daxili …ôm…ôk qaydalarƒ± aktƒ±nƒ±n m√∂vcudluƒüu v…ô qanunvericiliy…ô uyƒüunluƒüu","HR prosedurlarƒ±nƒ±n s…ôn…ôdl…ô≈üdirilm…ôsi (recruitment, onboarding, offboarding)","Konfidensiallik v…ô m…ôxfilik siyas…ôtl…ôrinin m√∂vcudluƒüu","Etik kodeksin m√∂vcudluƒüu v…ô i≈ü√ßil…ôr…ô √ßatdƒ±rƒ±lmasƒ±","≈ûikay…ôt mexanizminin m√∂vcudluƒüu v…ô i≈ül…ôrliyi","Anti-korrupsiya v…ô anti-r√º≈üv…ôtxorluq siyas…ôtl…ôri","Davranƒ±≈ü qaydalarƒ± v…ô intizam prosedurlarƒ±"], "1.2 Struktur v…ô Rollar": ["T…ô≈ükilati strukturun m√∂vcudluƒüu v…ô aktualla≈üdƒ±rƒ±lmasƒ±","V…ôzif…ô t…ôlimatlarƒ±nƒ±n b√ºt√ºn v…ôzif…ôl…ôr √ºzr…ô m√∂vcudluƒüu","V…ôzif…ô t…ôlimatlarƒ±nƒ±n aktualla≈üdƒ±rƒ±lmasƒ± (son 2 il …ôrzind…ô)","S…ôlahiyy…ôt v…ô m…ôsuliyy…ôt matrisinin m√∂vcudluƒüu","HR departamentinin strukturu v…ô resurslarƒ±nƒ±n kifay…ôtliyi","Rol v…ô m…ôsuliyy…ôtl…ôrin aydƒ±n m√º…ôyy…ônl…ô≈üdirilm…ôsi"], "1.3 Compliance v…ô Risk ƒ∞dar…ôetm…ôsi": ["∆èm…ôk M…ôc…ôll…ôsi t…ôl…ôbl…ôrin…ô uyƒüunluq","SSƒ∞V (DOST) …ôlaq…ôl…ôrinin d√ºzg√ºnl√ºy√º","Vergi qanunvericiliyin…ô uyƒüunluq","M…ôlumat m√ºhafiz…ôsi v…ô GDPR t…ôl…ôbl…ôrin…ô uyƒüunluq","HR risk reyestrinin m√∂vcudluƒüu","Daxili n…ôzar…ôt mexanizml…ôrinin m√∂vcudluƒüu","Xarici audit t√∂vsiyy…ôl…ôrinin icrasƒ±nƒ±n monitorinqi"]}},
            "2. Recruitment & Onboarding": { icon: "fa-user-plus", subcategories: { "2.1 ƒ∞≈ü…ô Q…ôbul Prosesi": ["ƒ∞≈ü…ô q…ôbul prosedurlarƒ±nƒ±n s…ôn…ôdl…ô≈üdirilm…ôsi","Vakansiya t…ôsdiql…ôm…ô prosesinin m√∂vcudluƒüu","ƒ∞≈ü elanlarƒ±nƒ±n qanunvericiliy…ô uyƒüunluƒüu","Namiz…ôdl…ôrin se√ßim meyarlarƒ±nƒ±n m√∂vcudluƒüu","M√ºsahib…ô prosesinin strukturla≈üdƒ±rƒ±lmasƒ±","Reference check prosesinin h…ôyata ke√ßirilm…ôsi","Background check prosedurlarƒ±nƒ±n m√∂vcudluƒüu","Job offer m…ôktublarƒ±nƒ±n standartla≈üdƒ±rƒ±lmasƒ±","ƒ∞≈ü…ô q…ôbul q…ôrarlarƒ±nƒ±n s…ôn…ôdl…ô≈üdirilm…ôsi"], "2.2 ≈û…ôxsi ƒ∞≈ül…ôr v…ô S…ôn…ôdl…ô≈üm…ô": ["≈û…ôxsi i≈ül…ôrin tam komplektliyi","∆èriz…ô v…ô CV-nin m√∂vcudluƒüu","≈û…ôxsiyy…ôt v…ôsiq…ôsinin sur…ôtinin m√∂vcudluƒüu","T…ôhsil haqqƒ±nda s…ôn…ôdl…ôrin sur…ôtl…ôrinin m√∂vcudluƒüu","ƒ∞xtisas sertifikatlarƒ±nƒ±n m√∂vcudluƒüu","Tibbi arayƒ±≈üƒ±n m√∂vcudluƒüu","∆èvv…ôlki i≈ü yerl…ôrind…ôn …ôm…ôk kitab√ßasƒ±nƒ±n sur…ôti","Foto ≈ü…ôkill…ôrin m√∂vcudluƒüu","H…ôrbi qulluqla baƒülƒ± s…ôn…ôdl…ôrin m√∂vcudluƒüu","Ail…ô v…ôziyy…ôti haqqƒ±nda s…ôn…ôdl…ôrin m√∂vcudluƒüu","Bank rekvizitl…ôrinin m√∂vcudluƒüu","Konfidensiallik m√ºqavil…ôsinin imzalanmasƒ±","∆èMAS-a (Sƒ∞MA) qeydiyyatƒ±n d√ºzg√ºnl√ºy√º"], "2.3 ∆èm…ôk M√ºqavil…ôl…ôri": ["∆èm…ôk m√ºqavil…ôl…ôrinin yazƒ±lƒ± formasƒ±nƒ±n m√∂vcudluƒüu","M√ºqavil…ôl…ôrin qanunvericiliy…ô uyƒüunluƒüu","Sƒ±naq m√ºdd…ôtinin d√ºzg√ºn t…ôtbiqi","ƒ∞≈ü v…ôzif…ôsinin d…ôqiq g√∂st…ôrilm…ôsi","∆èm…ôk haqqƒ± m…ôbl…ôƒüinin d√ºzg√ºn …ôks olunmasƒ±","ƒ∞≈ü saatlarƒ±nƒ±n v…ô i≈ü rejiminin g√∂st…ôrilm…ôsi","ƒ∞≈ü yerinin g√∂st…ôrilm…ôsi","M√ºqavil…ô m√ºdd…ôtinin g√∂st…ôrilm…ôsi","T…ôr…ôfl…ôrin imzalarƒ±nƒ±n m√∂vcudluƒüu","ƒ∞≈ü√ßiy…ô n√ºsx…ônin t…ôhvil verilm…ôsi"], "2.4 Onboarding Prosesi": ["Onboarding proqramƒ±nƒ±n m√∂vcudluƒüu","Yeni i≈ü√ßil…ôr √º√ß√ºn orientasiya t…ôliml…ôri","ƒ∞≈ü yerinin hazƒ±rlanmasƒ±","Mentor/buddy t…ôyin edilm…ôsi","ƒ∞lk g√ºnl…ôr √º√ß√ºn checklist-in m√∂vcudluƒüu","Sƒ±naq m√ºdd…ôti qiym…ôtl…ôndirm…ô prosesinin h…ôyata ke√ßirilm…ôsi"]}},
            "3. ∆èm…ôk M√ºnasib…ôtl…ôri": { icon: "fa-handshake", subcategories: { "3.1 D…ôyi≈üiklikl…ôr": ["V…ôzif…ô d…ôyi≈üiklikl…ôrinin r…ôsmil…ô≈üdirilm…ôsi","∆èlav…ô razƒ±la≈ümalarƒ±n uyƒüunluƒüu","∆èm…ôk haqqƒ± d…ôyi≈üiklikl…ôrinin s…ôn…ôdl…ô≈üdirilm…ôsi","ƒ∞≈ü yeri d…ôyi≈üiklikl…ôrinin d√ºzg√ºnl√ºy√º","ƒ∞≈ü rejimi d…ôyi≈üiklikl…ôrinin r…ôsmil…ô≈üdirilm…ôsi","K√∂√ß√ºrm…ô …ômrl…ôrinin uyƒüunluƒüu","∆èMAS-da d…ôyi≈üiklikl…ôrin …ôks olunmasƒ±"], "3.2 ƒ∞≈ü Vaxtƒ±nƒ±n U√ßotu": ["ƒ∞≈ü vaxtƒ± u√ßotunun aparƒ±lma formasƒ±","Faktiki i≈ü saatlarƒ±nƒ±n qeydiyyatƒ±","Tabelin d√ºzg√ºn aparƒ±lmasƒ±","Gec g…ôlm…ô/erk…ôn √ßƒ±xƒ±≈ü qeydiyyatƒ±","HRIS i≈ül…ôrliyi","ƒ∞≈ü vaxtƒ± normalarƒ±na riay…ôt","Gec…ô i≈ü saatlarƒ±nƒ±n u√ßotu","Bayram/istirah…ôt g√ºnl…ôrind…ô i≈üin u√ßotu"], "3.3 N√∂vb…ôli ƒ∞≈ü": ["N√∂vb…ô c…ôdv…ôll…ôrinin uyƒüunluƒüu","C…ôml…ônmi≈ü i≈ü vaxtƒ± u√ßotu","Fasil…ôl…ôrin t…ômin edilm…ôsi","Gec…ô n√∂vb…ôl…ôrinin uyƒüunluƒüu","√áoxn√∂vb…ôli i≈ü qrafiki","ƒ∞≈ü√ßil…ôrin razƒ±lƒ±ƒüƒ±nƒ±n alƒ±nmasƒ±","N√∂vb…ô d…ôyi≈üiklikl…ôrinin qeydiyyatƒ±"], "3.4 ƒ∞ntizam": ["ƒ∞ntizam pozuntularƒ±nƒ±n qeydiyyatƒ±","ƒ∞zahat m…ôktublarƒ±nƒ±n alƒ±nmasƒ±","T√∂hm…ôt …ômrl…ôrinin uyƒüunluƒüu","≈ûidd…ôtli t√∂hm…ôt …ôsaslandƒ±rƒ±lmasƒ±","C…ôzalarƒ±n proporsionallƒ±ƒüƒ±","C…ôza m√ºdd…ôtl…ôrinin riay…ôt edilm…ôsi","M√ºdafi…ô h√ºququnun t…ômini","ƒ∞ntizam i≈ül…ôrinin s…ôn…ôdl…ô≈üdirilm…ôsi"], "3.5 Xitam": ["ƒ∞≈üd…ôn √ßƒ±xarma …ôsaslarƒ±nƒ±n qanunilliyi","X…ôb…ôrdarlƒ±q m√ºdd…ôtl…ôri","ƒ∞xtisar proseduralarƒ±","√ñd…ôni≈ül…ôrin tam hesablanmasƒ±","M…ôzuniyy…ôt kompensasiyasƒ±","√áƒ±xarma kartƒ±","∆èMAS √ßƒ±xarƒ±≈üƒ±","∆èm…ôk kitab√ßasƒ± yazƒ±lƒ±≈ülarƒ±","Exit interview","Offboarding checklist"]}},
            "4. M…ôzuniyy…ôtl…ôr": { icon: "fa-umbrella-beach", subcategories: { "4.1 ƒ∞llik M…ôzuniyy…ôt": ["Planƒ±n t…ôrtibi","M…ôzuniyy…ôt h√ºququnun hesablanmasƒ±","∆èriz…ôl…ôrin r…ôsmil…ô≈üdirilm…ôsi","∆èmrl…ôrin d√ºzg√ºnl√ºy√º","√ñd…ôni≈ül…ôrin hesablanmasƒ±","3 g√ºn …ôvv…ôl √∂d…ôni≈ü","Min. 14 g√ºn t…ôl…ôbi","ƒ∞stifad…ô olunmamƒ±≈ü g√ºnl…ôrin u√ßotu","Kompensasiyalarƒ±n hesablanmasƒ±"], "4.2 ∆èlav…ô M…ôzuniyy…ôt": ["T…ôhsil m…ôzuniyy…ôtl…ôri","Hamil…ôlik v…ô doƒüum","U≈üaq baxƒ±mƒ±","√ñd…ôni≈üsiz m…ôzuniyy…ôtl…ôr","Qism…ôn √∂d…ôni≈üli sosial m…ôzuniyy…ôt","Dig…ôr sosial m…ôzuniyy…ôtl…ôr"], "4.3 X…ôst…ôlik": ["X…ôst…ôlik v…ôr…ôq…ôl…ôrinin t…ôrtibi","Elektron sistemd…ô yoxlama","V…ôr…ôq…ôl…ôrin u√ßotu","M√ºavin…ôtin hesablanmasƒ±","SSƒ∞V kompensasiyasƒ±","√ñd…ôni≈ül…ôrin d√ºzg√ºnl√ºy√º"]}},
            "5. Payroll": { icon: "fa-money-bill-1", subcategories: { "5.1 Sisteml…ôr": ["∆èm…ôk haqqƒ± siyas…ôti","Maa≈ü strukturu","Grade/band sistemi","Minimum …ôm…ôk haqqƒ±","Artƒ±m prosedurlarƒ±","Bonus sisteml…ôri","∆èlav…ô √∂d…ôni≈ül…ôr"], "5.2 Hesablamalar": ["Faktiki saatlara uyƒüunluq","Aylƒ±q hesablamalarƒ±n d…ôqiqliyi","∆èlav…ô i≈ü saatlarƒ± √∂d…ôni≈üi","Gec…ô saatlarƒ± √∂d…ôni≈üi","Bayram g√ºn√º √∂d…ôni≈üi","N√∂vb…ôli qrafik √∂d…ôni≈üi","C…ôml…ônmi≈ü u√ßot √∂d…ôni≈üi","M…ôzuniyy…ôt √∂d…ôni≈üi","Orta …ôm…ôk haqqƒ±","X…ôst…ôlik m√ºavin…ôti","Ezamiyy…ô √∂d…ôni≈üi"], "5.3 Tutulmalar": ["G…ôlir vergisi (14%)","SSƒ∞V (3%)","ƒ∞≈üsizlik (0.5%)","ƒ∞≈ü…ôg√∂t√ºr…ôn SSƒ∞V (22%)","ƒ∞cra v…ôr…ôq…ôl…ôri","Alimentl…ôr","Avanslar","Dig…ôr qanuni tutulmalar"], "5.4 Prosesl…ôr": ["Payroll calendar","√ñd…ôni≈ü tarixl…ôri","Payslipl…ôrin verilm…ôsi","Bank k√∂√ß√ºrm…ôl…ôri","Arxivl…ô≈üdirm…ô","M…ôxfilik","Hesabatlar"], "5.5 Ezamiyy…ô": ["∆èmrl…ôrin t…ôrtibi","Ezamiyy…ô v…ôsiq…ôl…ôri","G√ºnd…ôlik √∂d…ôni≈ül…ôr","Yol x…ôrcl…ôri","Ya≈üayƒ±≈ü x…ôrcl…ôri","Hesabatlarƒ±n t…ôqdimi","Xarici ezamiyy…ôtl…ôr"]}},
            "6. Benefits": { icon: "fa-gift", subcategories: { "6.1 Sosial Paket": ["Siyas…ôtin m√∂vcudluƒüu","Tibbi sƒ±ƒüorta","H…ôyat sƒ±ƒüortasƒ±","Pensiya proqramƒ±","Nahar/n…ôqliyyat","T…ôhsil d…ôst…ôyi","ƒ∞dman/wellness","Dig…ôr benefits"], "6.2 Performans": ["Qiym…ôtl…ôndirm…ô sistemi","KPI v…ô m…ôqs…ôdl…ôr","M√ºt…ômadi qiym…ôtl…ôndirm…ô","360 d…ôr…ôc…ô","Improvement plans","Performans-m√ºkafat …ôlaq…ôsi"], "6.3 Bonuslar": ["Bonus siyas…ôti","ƒ∞llik bonuslar","Layih…ô bonuslarƒ±","T…ô≈üviq proqramlarƒ±","Recognition","T…ôqa√ºd/m√ºkafatlar"]}},
            "7. T…ôlim (L&D)": { icon: "fa-graduation-cap", subcategories: { "7.1 Proqramlar": ["ƒ∞llik plan","Ehtiyac analizi (TNA)","Onboarding t…ôliml…ôri","Texniki t…ôliml…ôr","Soft skills","Liderlik proqramlarƒ±","Compliance t…ôliml…ôri","Effektivlik qiym…ôtl…ôndirm…ôsi","B√ºdc…ô idar…ôetm…ôsi"], "7.2 Karyera": ["ƒ∞nki≈üaf planlarƒ±","Succession planning","Mentorluq","Daxili mobillik","Talent management","ƒ∞nki≈üaf m…ôrk…ôzl…ôri"]}},
            "8. HRIS": { icon: "fa-desktop", subcategories: { "8.1 Funksionallƒ±q": ["Sistemin m√∂vcudluƒüu","M…ôlumat d…ôqiqliyi","Faktiki uyƒüunluq","ƒ∞≈ü vaxtƒ± modulu","Payroll modulu","M…ôzuniyy…ôt modulu","Performans modulu","Recruitment modulu","T…ôlim modulu"], "8.2 ƒ∞nteqritet": ["M…ôlumat aktuallƒ±ƒüƒ±","T…ôkrarlanma yoxlanƒ±≈üƒ±","Backup prosesl…ôri","Miqrasiya d√ºzg√ºnl√ºy√º","Sistem auditl…ôri","Data cleaning"], "8.3 T…ôhl√ºk…ôsizlik": ["Giri≈ü h√ºquqlarƒ±","Parol siyas…ôti","M…ôxfilik t…ôdbirl…ôri","Loglarƒ±n saxlanmasƒ±","Kibert…ôhl√ºk…ôsizlik","GDPR uyƒüunluƒüu"], "8.4 ƒ∞nteqrasiya": ["∆èMAS (Sƒ∞MA)","U√ßot sisteml…ôri","Bank sisteml…ôri","SSƒ∞V (DOST)","E-imza","API …ôlaq…ôl…ôri"]}},
            "9. Analytics": { icon: "fa-chart-line", subcategories: { "9.1 Metrikl…ôr": ["Headcount","Turnover rate","Absenteeism","Time to hire/fill","Cost per hire","Training ROI","Engagement","Diversity"], "9.2 Hesabatlar": ["Aylƒ±q hesabatlar","R√ºbl√ºk analitika","ƒ∞llik hesabatlar","SSƒ∞V hesabatlarƒ±nƒ±n d√ºzg√ºn t…ôrtib olunmasƒ±","Vergi hesabatlarƒ±nƒ±n vaxtƒ±nda t…ôqdim edilm…ôsi","ƒ∞statistik hesabatlarƒ±n hazƒ±rlanmasƒ±","D√∂vl…ôt orqanlarƒ±na hesabatlarƒ±n vaxtƒ±nda t…ôqdim edilm…ôsi"]}},
            "10. S∆èT∆èM": { icon: "fa-helmet-safety", subcategories: { "10.1 ƒ∞≈ü M√ºhafiz…ôsi": ["Siyas…ôtl…ôr","Cavabdeh ≈ü…ôxsl…ôr","Attestasiya","Risk qiym…ôtl…ôndirm…ô","Tibbi m√ºayin…ôl…ôr","T…ôliml…ôr","F…ôrdi m√ºhafiz…ô","Q…ôza qeydiyyatƒ±","Pe≈ü…ô x…ôst…ôlikl…ôri"], "10.2 F√∂vq…ôlad…ô": ["T…ôxliy…ô planlarƒ±","Yanƒüƒ±n t…ôhl√ºk…ôsizliyi","ƒ∞lk yardƒ±m","∆èlaq…ô m…ôlumatlarƒ±","Krizis planƒ±"]}},
            "11. Engagement": { icon: "fa-heart", subcategories: { "11.1 M…ômnuniyy…ôt": ["Sorgular","Pulse surveys","Exit interview analizi","Stay interviews","≈ûikay…ôt mexanizmi","eNPS"], "11.2 M…ôd…ôniyy…ôt": ["D…ôy…ôrl…ôr","Kommunikasiya","Team building","T…ôdbirl…ôr","Daxili kanallar","Recognition"]}},
            "12. DEI": { icon: "fa-people-group", subcategories: { "12.1 Siyas…ôtl…ôr": ["DEI siyas…ôti","B…ôrab…ôr imkanlar","Anti-diskriminasiya","Harassment","∆èlillik h√ºquqlarƒ±","Gender pay gap","Metrikl…ôr"]}},
            "13. Vendorlar": { icon: "fa-file-signature", subcategories: { "13.1 ƒ∞dar…ôetm…ô": ["HR provayderl…ôri","Recruitment agentlikl…ôri","T…ôlim provayderl…ôri","Payroll outsourcing","Background check","Sƒ±ƒüorta ≈üirk…ôtl…ôri","HRIS vendorlarƒ±","SLA monitorinqi"]}},
            "14. S…ôn…ôdl…ô≈üm…ô": { icon: "fa-folder-open", subcategories: { "14.1 ƒ∞dar…ôetm…ô": ["Siyas…ôt","Saxlanma qaydalarƒ±","Arxivl…ô≈üdirm…ô","M…ôhv edilm…ô","Elektron d√∂vriyy…ô","Giri≈ü h√ºquqlarƒ±","T…ôhl√ºk…ôsizlik","Saxlama m√ºdd…ôtl…ôri"]}},
            "15. Audit": { icon: "fa-list-check", subcategories: { "15.1 Monitorinq": ["Daxili audit","Xarici audit","Checklistl…ôr","N√∂qsan planlarƒ±","M√ºf…ôtti≈ülik hazƒ±rlƒ±ƒüƒ±","SSƒ∞V hazƒ±rlƒ±ƒüƒ±","Vergi hazƒ±rlƒ±ƒüƒ±","T√∂vsiyy…ô izl…ônm…ôsi"]}},
            "16. F…ôaliyy…ôtin d…ôy…ôrl…ôndirilm…ôsi v…ô karyera inki≈üafƒ±": { icon: "fa-list-check", subcategories: { "15.1 F…ôaliyy…ôtin d…ôy…ôrl…ôndirilm…ôsi v…ô karyera inki≈üafƒ±": ["Davranƒ±≈ü kompetensiyalarƒ± √ºzr…ô qiym…ôtl…ôndirm…ô","Texniki bacarƒ±qlar √ºzr…ô qiym…ôtl…ôndirm…ô","Karyera inki≈üafƒ± modeli (non-agile / agile)","M√ºkafatlandƒ±rma","Feedback m…ôd…ôniyy…ôti"]}}
        };

        let auditItems = {};
        let currentItemId = null;

        async function init() {
            renderCategories();
            await loadFromGoogleSheets();
            Object.keys(auditData).forEach(cat => updateCategoryProgress(cat));
            updateStats();
            setupSearch();
        }

        function renderCategories() {
            const container = document.getElementById('categoriesContainer');
            container.innerHTML = '';
            let globalCounter = 1;

            for (const [category, data] of Object.entries(auditData)) {
                const safeCatId = category.replace(/[^a-zA-Z0-9]/g, '');
                let catHTML = `
                <div class="category">
                    <div class="category-header" onclick="toggleCategory(this)">
                        <div class="cat-left">
                            <div class="category-icon-wrapper"><i class="fas ${data.icon}"></i></div>
                            <div>
                                <div class="category-title">${category}</div>
                                <div class="category-badge">Kateqoriya</div>
                            </div>
                        </div>
                        <div class="cat-right">
                            <div class="cat-progress-container">
                                <div class="cat-progress-bar"><div class="cat-progress-fill" id="prog-bar-${safeCatId}"></div></div>
                                <div class="cat-progress-text" id="prog-text-${safeCatId}">0%</div>
                            </div>
                            <i class="fas fa-chevron-down category-toggle"></i>
                        </div>
                    </div>
                    <div class="category-content">
                `;

                for (const [subcategory, items] of Object.entries(data.subcategories)) {
                    catHTML += `
                        <div class="subcategory">
                            <div class="subcategory-header" onclick="toggleSubcategory(this)">
                                <span>${subcategory}</span>
                                <span class="subcategory-count">${items.length}</span>
                            </div>
                            <div class="subcategory-content">
                    `;
                    
                    items.forEach(item => {
                        const itemId = `item-${globalCounter}`;
                        catHTML += `
                            <div class="checklist-item" id="${itemId}" 
                                 data-id="${globalCounter}"
                                 data-category="${category}" 
                                 data-subcategory="${subcategory}" 
                                 data-item="${item}">
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" class="checkbox" onchange="toggleItem('${itemId}')">
                                </div>
                                <div class="item-content">
                                    <div class="item-text"><span class="item-id">#${globalCounter}</span> <span class="item-main-text">${item}</span></div>
                                    <div class="item-meta" id="meta-${itemId}"></div>
                                    <div class="item-note-display" id="note-display-${itemId}">
                                        <span class="item-note-label">Qeyd:</span>
                                        <span id="note-text-${itemId}"></span>
                                    </div>
                                </div>
                                <button class="btn-note" onclick="openNoteModal('${itemId}')">
                                    <i class="fas fa-pen"></i> Qeyd
                                </button>
                            </div>
                        `;
                        globalCounter++;
                    });
                    catHTML += `</div></div>`;
                }
                catHTML += `</div></div>`;
                container.innerHTML += catHTML;
            }
        }

        async function loadFromGoogleSheets() {
            const syncDiv = document.getElementById('syncStatus');
            const syncText = document.getElementById('syncText');
            syncDiv.classList.add('sync-loading');
            syncText.innerText = "Y√ºkl…ônir...";
            
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL);
                const data = await response.json();
                
                data.forEach(row => {
                    const itemId = `item-${row.id}`;
                    const el = document.getElementById(itemId);
                    
                    if (el) {
                        auditItems[itemId] = {
                            id: row.id,
                            category: row.category,
                            subcategory: row.subcategory,
                            item: row.item,
                            status: row.status,
                            responsible: row.responsible,
                            priority: row.priority,
                            dueDate: row.dueDate ? row.dueDate.split('T')[0] : '',
                            notes: row.notes,
                            checked: row.status === 'completed'
                        };

                        el.querySelector('.checkbox').checked = (row.status === 'completed');
                        updateItemUI(itemId);
                    }
                });
                
                syncDiv.classList.remove('sync-loading');
                syncText.innerText = "Google Sheets Aktiv";
                
            } catch (error) {
                console.error("Sync Error:", error);
                syncDiv.classList.remove('sync-loading');
                syncDiv.style.backgroundColor = 'var(--danger-bg)';
                syncDiv.style.color = 'var(--danger-text)';
                syncText.innerText = "X…ôta: Sync Failed";
            }
        }

        function updateItemUI(itemId) {
            const el = document.getElementById(itemId);
            const data = auditItems[itemId];
            if(!el || !data) return;

            if (data.checked) el.classList.add('checked'); else el.classList.remove('checked');
            if (data.notes || (data.status && data.status !== 'pending')) el.classList.add('has-notes'); else el.classList.remove('has-notes');

            updateMetaBadges(itemId);

            const noteDisplay = document.getElementById(`note-display-${itemId}`);
            const noteText = document.getElementById(`note-text-${itemId}`);
            if (data.notes && data.notes.trim() !== '') {
                noteDisplay.classList.add('visible');
                noteText.innerText = data.notes;
            } else {
                noteDisplay.classList.remove('visible');
                noteText.innerText = '';
            }
        }

        function toggleItem(itemId) {
            const el = document.getElementById(itemId);
            const checkbox = el.querySelector('.checkbox');
            const isChecked = checkbox.checked;
            const uniqueId = el.dataset.id;

            if(!auditItems[itemId]) auditItems[itemId] = {};
            
            auditItems[itemId].checked = isChecked;
            auditItems[itemId].status = isChecked ? 'completed' : 'pending';

            updateItemUI(itemId);
            updateStats();
            updateCategoryProgress(el.dataset.category);
            saveAuditData();

            sendToGoogleSheets({
                id: String(uniqueId), 
                category: el.dataset.category,
                subcategory: el.dataset.subcategory,
                item: el.dataset.item,
                status: auditItems[itemId].status,
                notes: auditItems[itemId].notes || '',
                responsible: auditItems[itemId].responsible || '',
                priority: auditItems[itemId].priority || '',
                dueDate: auditItems[itemId].dueDate || ''
            });
        }

        function openNoteModal(itemId) {
            currentItemId = itemId;
            const data = auditItems[itemId] || {};
            document.getElementById('itemStatus').value = data.status || 'pending';
            document.getElementById('itemNotes').value = data.notes || '';
            document.getElementById('responsiblePerson').value = data.responsible || '';
            document.getElementById('itemPriority').value = data.priority || 'medium';
            document.getElementById('itemDueDate').value = data.dueDate || '';
            document.getElementById('noteModal').classList.add('active');
        }
        function closeModal() { document.getElementById('noteModal').classList.remove('active'); currentItemId = null; }

        document.getElementById('noteForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            if(!currentItemId) return;

            const el = document.getElementById(currentItemId);
            const uniqueId = el.dataset.id;
            
            const status = document.getElementById('itemStatus').value;
            const notes = document.getElementById('itemNotes').value;
            const responsible = document.getElementById('responsiblePerson').value;
            const priority = document.getElementById('itemPriority').value;
            const dueDate = document.getElementById('itemDueDate').value;
            
            let shouldCheck = (status === 'completed');
            
            auditItems[currentItemId] = {
                id: uniqueId,
                category: el.dataset.category,
                subcategory: el.dataset.subcategory,
                item: el.dataset.item,
                status, notes, responsible, priority, dueDate,
                checked: shouldCheck
            };

            el.querySelector('.checkbox').checked = shouldCheck;

            updateItemUI(currentItemId);
            updateStats();
            updateCategoryProgress(el.dataset.category);
            saveAuditData();
            closeModal();
            showNotification('M…ôlumat yadda saxlanƒ±lƒ±r...');

            // Force Send to Google Sheets
            await sendToGoogleSheets({
                id: String(uniqueId),
                category: el.dataset.category,
                subcategory: el.dataset.subcategory,
                item: el.dataset.item,
                status: status,
                notes: notes,
                responsible: responsible,
                priority: priority,
                dueDate: dueDate
            });
        });

        function updateMetaBadges(id) { 
            const d = auditItems[id]; 
            const div = document.getElementById(`meta-${id}`); 
            if(!d) { div.innerHTML=''; return; } 
            let h = ''; 
            let sC = 'status', sT = '';

            if(d.status==='completed') { sT='‚úÖ Tamamlandƒ±'; sC='status'; }
            else if(d.status==='in-progress') { sT='üîÑ ƒ∞crada'; sC='status'; }
            else if(d.status==='issue') { sT='‚ö†Ô∏è Problem'; sC='priority'; }
            else if(d.status==='pending') { sT='‚è≥ G√∂zl…ôyir'; sC='date'; }

            if(d.status && d.status!=='pending') h+=`<span class="meta-badge ${sC}">${sT}</span>`; 
            
            if(d.responsible) h+=`<span class="meta-badge responsible"><i class="fas fa-user"></i> ${d.responsible}</span>`; 
            if(d.priority && d.priority!=='medium') { 
                const m={'low':'üü¢ A≈üaƒüƒ±','high':'üü† Y√ºks…ôk','critical':'üî¥ Kritik'}; 
                h+=`<span class="meta-badge priority">${m[d.priority]}</span>`; 
            } 
            if(d.dueDate) h+=`<span class="meta-badge date"><i class="fas fa-calendar"></i> ${d.dueDate}</span>`; 
            div.innerHTML = h; 
        }

        function toggleCategory(header) { header.nextElementSibling.classList.toggle('active'); header.querySelector('.category-toggle').classList.toggle('active'); }
        function toggleSubcategory(header) { header.nextElementSibling.classList.toggle('active'); }
        function updateCategoryProgress(cat) { const safe = cat.replace(/[^a-zA-Z0-9]/g, ''); const bar = document.getElementById(`prog-bar-${safe}`); const txt = document.getElementById(`prog-text-${safe}`); if(!bar) return; const items = document.querySelectorAll(`.checklist-item[data-category="${cat}"]`); let c = 0; items.forEach(i => { if(i.querySelector('.checkbox').checked) c++; }); const p = items.length ? Math.round((c/items.length)*100) : 0; bar.style.width = `${p}%`; txt.innerText = `${p}%`; }
        function updateStats() { const all = document.querySelectorAll('.checklist-item'); let c=0, n=0; all.forEach(i => { if(i.classList.contains('checked')) c++; if(i.classList.contains('has-notes')) n++; }); const p = all.length ? Math.round((c/all.length)*100) : 0; document.getElementById('totalItems').innerText = all.length; document.getElementById('checkedItems').innerText = c; document.getElementById('withNotes').innerText = n; document.getElementById('progressPercent').innerText = p+'%'; document.getElementById('progressBar').style.width = p+'%'; }
        function saveAuditData() { document.querySelectorAll('.checklist-item').forEach(el => { const id = el.id; if(!auditItems[id]) auditItems[id] = {}; auditItems[id].checked = el.querySelector('.checkbox').checked; }); localStorage.setItem('birbankFinalDesignV2', JSON.stringify(auditItems)); }
        function showNotification(m) { const n = document.getElementById('notification'); document.getElementById('notificationText').innerText = m; n.classList.add('active'); setTimeout(() => n.classList.remove('active'), 3000); }
        
        async function sendToGoogleSheets(data) { 
            try { 
                await fetch(GOOGLE_SCRIPT_URL, { 
                    method: 'POST', mode: 'no-cors', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify(data) 
                }); 
            } catch (e) { console.error(e); } 
        }

        function setupSearch() { document.getElementById('searchInput').addEventListener('input', (e) => { const t = e.target.value.toLowerCase(); document.querySelectorAll('.checklist-item').forEach(i => { if(i.innerText.toLowerCase().includes(t)) { i.style.display='flex'; i.closest('.category-content').classList.add('active'); i.closest('.subcategory-content').classList.add('active'); } else { i.style.display='none'; } }); }); }
        function filterItems(t) { document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active')); event.currentTarget.classList.add('active'); document.querySelectorAll('.checklist-item').forEach(i => { const c = i.classList.contains('checked'), n = i.classList.contains('has-notes'); if(t==='all') i.style.display='flex'; else if(t==='checked' && c) i.style.display='flex'; else if(t==='notes' && n) i.style.display='flex'; else i.style.display='none'; }); }
        function exportToExcel() { let csv = '\uFEFFID,Kateqoriya,Alt Kateqoriya,Madd…ô,Status,M…ôsul,Prioritet,Tarix,Qeyd\n'; for(const [id, d] of Object.entries(auditItems)) { if(d.checked || d.notes) { const el = document.getElementById(id); const uid = el ? el.dataset.id : ''; csv += `"${uid}","${d.category}","${d.subcategory}","${d.item}","${d.status}","${d.responsible}","${d.priority}","${d.dueDate}","${(d.notes||'').replace(/"/g, '""')}"\n`; } } const link = document.createElement('a'); link.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv;charset=utf-8;' })); link.download = 'Audit_Log.csv'; link.click(); }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
